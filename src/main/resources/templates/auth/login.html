<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script
      src="https://unpkg.com/unlazy@0.11.3/dist/unlazy.with-hashing.iife.js"
      defer
      init
    ></script>
    <script type="text/javascript">
      window.tailwind.config = {
        darkMode: ["class"],
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              popover: {
                DEFAULT: "hsl(var(--popover))",
                foreground: "hsl(var(--popover-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      @layer base {
        :root {
          --background: 0 0% 100%;
          --foreground: 224 71.4% 4.1%;
          --card: 0 0% 100%;
          --card-foreground: 224 71.4% 4.1%;
          --popover: 0 0% 100%;
          --popover-foreground: 224 71.4% 4.1%;
          --primary: 262.1 83.3% 57.8%;
          --primary-foreground: 210 20% 98%;
          --secondary: 220 14.3% 95.9%;
          --secondary-foreground: 220.9 39.3% 11%;
          --muted: 220 14.3% 95.9%;
          --muted-foreground: 220 8.9% 46.1%;
          --accent: 220 14.3% 95.9%;
          --accent-foreground: 220.9 39.3% 11%;
          --destructive: 0 84.2% 60.2%;
          --destructive-foreground: 210 20% 98%;
          --border: 220 13% 91%;
          --input: 220 13% 91%;
          --ring: 262.1 83.3% 57.8%;
        }
        .dark {
          --background: 224 71.4% 4.1%;
          --foreground: 210 20% 98%;
          --card: 224 71.4% 4.1%;
          --card-foreground: 210 20% 98%;
          --popover: 224 71.4% 4.1%;
          --popover-foreground: 210 20% 98%;
          --primary: 263.4 70% 50.4%;
          --primary-foreground: 210 20% 98%;
          --secondary: 215 27.9% 16.9%;
          --secondary-foreground: 210 20% 98%;
          --muted: 215 27.9% 16.9%;
          --muted-foreground: 217.9 10.6% 64.9%;
          --accent: 215 27.9% 16.9%;
          --accent-foreground: 210 20% 98%;
          --destructive: 0 62.8% 30.6%;
          --destructive-foreground: 210 20% 98%;
          --border: 215 27.9% 16.9%;
          --input: 215 27.9% 16.9%;
          --ring: 263.4 70% 50.4%;
        }
      }
    </style>
    <!-- Add Font Awesome for better icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- Add Favicon for the tab icon -->
    <link rel="icon" type="image/png" th:href="@{/img/logo.png}" />
    <title>Đăng nhập - Hệ thống Giám sát và Cảnh báo Dịch bệnh</title>
    <!-- Ensure AuthService is loaded and deferred -->
    <script th:src="@{/js/services/auth-service.js}" defer></script>
  </head>
  <body>
    <div class="flex min-h-screen bg-background">
      <!-- Form Section -->
      <div class="flex-1 flex items-center justify-center p-8">
        <div class="w-full max-w-md space-y-6">
          <div class="text-center">
            <h2 class="text-3xl font-bold text-foreground">Đăng nhập</h2>
            <p class="text-muted-foreground">
              Nhập thông tin đăng nhập của bạn để tiếp tục
            </p>
          </div>

          <form id="loginForm">
            <div>
              <label
                class="block text-sm font-medium text-foreground"
                for="username"
              >
                <i class="fas fa-user mr-2"></i>Tài khoản
              </label>
              <input
                class="mt-1 block w-full border border-border rounded-md p-2 pl-10 focus:ring focus:ring-ring transition duration-200"
                type="text"
                id="username"
                name="username"
                placeholder="Nhập tên đăng nhập"
                required
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-foreground"
                for="password"
              >
                <i class="fas fa-lock mr-2"></i>Mật khẩu
              </label>
              <div class="relative">
                <input
                  class="mt-1 block w-full border border-border rounded-md p-2 pl-10 focus:ring focus:ring-ring transition duration-200"
                  type="password"
                  id="password"
                  name="password"
                  placeholder="Nhập mật khẩu"
                  required
                />
                <button
                  type="button"
                  onclick="togglePassword()"
                  class="absolute right-3 top-1/2 -translate-y-1/2"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>

            <div class="flex items-center justify-between">
              <label class="flex items-center">
                <input type="checkbox" class="mr-2" name="remember-me" />
                <span class="text-sm text-muted-foreground"
                  >Ghi nhớ đăng nhập</span
                >
              </label>
              <a href="#" class="text-sm text-primary hover:underline"
                >Quên mật khẩu?</a
              >
            </div>

            <button
              type="submit"
              class="w-full bg-primary text-primary-foreground hover:bg-primary/90 p-2 rounded-lg transition duration-200 flex items-center justify-center"
            >
              <i class="fas fa-sign-in-alt mr-2"></i>
              ĐĂNG NHẬP
            </button>
          </form>

          <div class="relative">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-border"></div>
            </div>
            <div class="relative flex justify-center text-xs uppercase">
              <span class="bg-card px-2 text-muted-foreground"
                >Hoặc đăng nhập với</span
              >
            </div>
          </div>

          <div class="flex flex-col space-y-2">
            <button
              class="flex items-center justify-center border border-border rounded-lg p-2 transition duration-200 hover:bg-secondary"
            >
              <i class="fab fa-google text-red-500 mr-2"></i>
              Đăng nhập với Google
            </button>
            <button
              class="flex items-center justify-center border border-border rounded-lg p-2 transition duration-200 hover:bg-secondary"
            >
              <i class="fab fa-facebook text-blue-600 mr-2"></i>
              Đăng nhập với Facebook
            </button>
          </div>

          <p class="text-sm text-center text-muted-foreground">
            Chưa có tài khoản?
            <a href="#" class="text-primary hover:underline">Đăng ký</a>
          </p>
        </div>
      </div>

      <!-- Background Image Section -->
      <div class="hidden lg:block flex-1 relative overflow-hidden">
        <img
          th:src="@{/img/auth/pattern.webp}"
          alt="Background"
          class="absolute inset-0 w-full h-full object-cover"
        />
        <div
          class="absolute inset-0 bg-gradient-to-r from-primary/20 to-primary/40 backdrop-blur-sm"
        ></div>
        <div class="absolute inset-0 flex items-center justify-center p-8">
          <div class="max-w-md text-white text-center">
            <h1 class="text-4xl font-bold mb-4">
              Hệ thống Giám sát và Cảnh báo Dịch bệnh
            </h1>
            <p class="text-lg">
              Giải pháp toàn diện cho việc theo dõi và phòng ngừa dịch bệnh
            </p>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Remove any local storage token checks
          const isValid = await AuthService.validateToken();
          if (isValid) {
            // Redirect if already authenticated
            const params = new URLSearchParams(window.location.search);
            const redirectUrl =
              params.get("redirect") || AuthService.REDIRECT_URL;
            window.location.href = redirectUrl;
          }
        } catch (error) {
          console.error("Auth check failed:", error);
        }
      });

      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;

          try {
            await AuthService.login(username, password);
          } catch (error) {
            alert("Đăng nhập thất bại: " + error.message);
          }
        });

      function togglePassword() {
        const password = document.getElementById("password");
        const type =
          password.getAttribute("type") === "password" ? "text" : "password";
        password.setAttribute("type", type);
        const icon = document.querySelector(
          'button[onclick="togglePassword()"] i'
        );
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      }
    </script>
  </body>
</html>
