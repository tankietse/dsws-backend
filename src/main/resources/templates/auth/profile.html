<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Thông tin cá nhân</title>
  </head>

  <body>
    <section layout:fragment="content">
      <form class="mx-auto max-w-5xl px-6 py-12 sm:py-16 lg:px-8">
        <div class="space-y-12">
          <div class="grid grid-cols-1 gap-x-8 lg:grid-cols-3">
            <!-- Main Profile Info -->
            <div class="lg:col-span-2">
              <div class="border-b border-gray-900/10 pb-12">
                <h2 class="text-base/7 font-semibold text-gray-900">
                  Thông tin cá nhân
                </h2>
                <p class="mt-1 text-sm/6 text-gray-600">
                  Thông tin cá nhân của bạn sẽ được hiển thị ở đây.
                </p>

                <div
                  class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                >
                  <!-- Họ tên - Span 3 -->
                  <div class="sm:col-span-3">
                    <label
                      for="hoTen"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Họ và tên</label
                    >
                    <div class="mt-2">
                      <input
                        type="text"
                        name="hoTen"
                        id="hoTen"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>

                  <!-- Chức vụ - Span 3 -->
                  <div class="sm:col-span-3">
                    <label
                      for="chucVu"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Chức vụ</label
                    >
                    <div class="mt-2">
                      <input
                        type="text"
                        name="chucVu"
                        id="chucVu"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>

                  <!-- Email - Span 3 -->
                  <div class="sm:col-span-3">
                    <label
                      for="email"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Email</label
                    >
                    <div class="mt-2">
                      <input
                        type="email"
                        name="email"
                        id="email"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>

                  <!-- Số điện thoại - Span 3 -->
                  <div class="sm:col-span-3">
                    <label
                      for="soDienThoai"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Số điện thoại</label
                    >
                    <div class="mt-2">
                      <input
                        type="tel"
                        name="soDienThoai"
                        id="soDienThoai"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>

                  <!-- Ngày sinh - Span 3 -->
                  <div class="sm:col-span-3">
                    <label
                      for="ngaySinh"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Ngày sinh</label
                    >
                    <div class="mt-2">
                      <input
                        type="date"
                        name="ngaySinh"
                        id="ngaySinh"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>

                  <!-- Địa chỉ - Span full -->
                  <div class="col-span-full">
                    <label
                      for="diaChi"
                      class="block text-sm/6 font-medium text-gray-900"
                      >Địa chỉ</label
                    >
                    <div class="mt-2">
                      <input
                        type="text"
                        name="diaChi"
                        id="diaChi"
                        readonly
                        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm/6"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Photo Section -->
            <div class="lg:col-span-1">
              <div class="border-b border-gray-900/10 pb-12">
                <h2 class="text-base/7 font-semibold text-gray-900">
                  Ảnh đại diện & Ảnh bìa
                </h2>
                <p class="mt-1 text-sm/6 text-gray-600">
                  Ảnh này sẽ được hiển thị công khai.
                </p>

                <div class="mt-10 space-y-10">
                  <!-- Avatar -->
                  <div class="col-span-full">
                    <label class="block text-sm/6 font-medium text-gray-900"
                      >Ảnh đại diện</label
                    >
                    <div class="mt-2 flex flex-col items-center gap-y-4">
                      <div
                        class="size-32 rounded-full ring-1 ring-inset ring-gray-300 overflow-hidden bg-gray-50 flex items-center justify-center"
                      >
                        <svg
                          class="size-24 text-gray-300"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                          aria-hidden="true"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                      <button
                        type="button"
                        disabled
                        class="rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
                      >
                        Thay đổi ảnh
                      </button>
                    </div>
                  </div>

                  <!-- Cover Photo -->
                  <div class="col-span-full">
                    <label class="block text-sm/6 font-medium text-gray-900"
                      >Ảnh bìa</label
                    >
                    <div
                      class="mt-2 flex justify-center rounded-lg ring-1 ring-dashed ring-gray-900/25 px-6 py-10"
                    >
                      <div class="text-center">
                        <svg
                          class="mx-auto size-12 text-gray-300"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                          aria-hidden="true"
                          data-slot="icon"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                        <div class="mt-4 flex text-sm/6 text-gray-600">
                          <span
                            class="relative cursor-not-allowed rounded-md bg-white font-semibold text-gray-400"
                          >
                            Tải ảnh lên
                          </span>
                          <p class="pl-1">hoặc kéo thả</p>
                        </div>
                        <p class="text-xs/5 text-gray-600">
                          PNG, JPG, GIF tối đa 10MB
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-6 flex items-center justify-end gap-x-6">
          <a
            href="/auth/profile/edit"
            class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
          >
            Chỉnh sửa thông tin
          </a>
        </div>
      </form>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          fetch("/api/v1/auth/profile", {
            credentials: "include", // Important: include credentials for cookies
            headers: {
              Accept: "application/json",
            },
          })
            .then((response) => {
              if (!response.ok) {
                if (response.status === 401 || response.status === 403) {
                  window.location.href = "/auth/login"; // Redirect to login page
                  throw new Error("Unauthorized");
                }
                return response.text().then((text) => {
                  throw new Error(text);
                });
              }
              return response.json();
            })
            .then((data) => {
              if (data.error) {
                throw new Error(data.error);
              }

              // Safely set text content with null checks
              const elements = {
                hoTen: data.hoTen,
                email: data.email,
                soDienThoai: data.soDienThoai,
                diaChi: data.diaChi,
                ngaySinh: data.ngaySinh,
                chucVu: data.chucVu,
              };

              Object.keys(elements).forEach((id) => {
                const element = document.getElementById(id);
                if (element) {
                  element.value = elements[id] || "N/A";
                }
              });
            })
            .catch((error) => {
              console.error("Error:", error);
              if (error.message !== "Unauthorized") {
                alert("Lỗi khi tải thông tin: " + error.message);
              }
            });
        });
      </script>
    </section>
  </body>
</html>
